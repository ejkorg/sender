<svg aria-roledescription="flowchart-v2" role="graphics-document document" viewBox="-8 -8 7527.9921875 890" style="max-width: 7527.99px; background-color: white;" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns="http://www.w3.org/2000/svg" width="100%" id="mermaid-1760662608727"><style>#mermaid-1760662608727{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-1760662608727 .error-icon{fill:#552222;}#mermaid-1760662608727 .error-text{fill:#552222;stroke:#552222;}#mermaid-1760662608727 .edge-thickness-normal{stroke-width:2px;}#mermaid-1760662608727 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1760662608727 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1760662608727 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1760662608727 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1760662608727 .marker{fill:#333333;stroke:#333333;}#mermaid-1760662608727 .marker.cross{stroke:#333333;}#mermaid-1760662608727 svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-1760662608727 .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-1760662608727 .cluster-label text{fill:#333;}#mermaid-1760662608727 .cluster-label span,#mermaid-1760662608727 p{color:#333;}#mermaid-1760662608727 .label text,#mermaid-1760662608727 span,#mermaid-1760662608727 p{fill:#333;color:#333;}#mermaid-1760662608727 .node rect,#mermaid-1760662608727 .node circle,#mermaid-1760662608727 .node ellipse,#mermaid-1760662608727 .node polygon,#mermaid-1760662608727 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-1760662608727 .flowchart-label text{text-anchor:middle;}#mermaid-1760662608727 .node .label{text-align:center;}#mermaid-1760662608727 .node.clickable{cursor:pointer;}#mermaid-1760662608727 .arrowheadPath{fill:#333333;}#mermaid-1760662608727 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-1760662608727 .flowchart-link{stroke:#333333;fill:none;}#mermaid-1760662608727 .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-1760662608727 .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-1760662608727 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-1760662608727 .cluster text{fill:#333;}#mermaid-1760662608727 .cluster span,#mermaid-1760662608727 p{color:#333;}#mermaid-1760662608727 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-1760662608727 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#333;}#mermaid-1760662608727 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}#mermaid-1760662608727 .db&gt;*{fill:#fef3c7!important;stroke:#b58900!important;}#mermaid-1760662608727 .db span{fill:#fef3c7!important;stroke:#b58900!important;}</style><g><marker orient="auto" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="10" viewBox="0 0 12 20" class="marker flowchart" id="flowchart-pointEnd"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 0 L 10 5 L 0 10 z"/></marker><marker orient="auto" markerHeight="12" markerWidth="12" markerUnits="userSpaceOnUse" refY="5" refX="0" viewBox="0 0 10 10" class="marker flowchart" id="flowchart-pointStart"><path style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 0 5 L 10 10 L 10 0 z"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="11" viewBox="0 0 10 10" class="marker flowchart" id="flowchart-circleEnd"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5" refX="-1" viewBox="0 0 10 10" class="marker flowchart" id="flowchart-circleStart"><circle style="stroke-width: 1; stroke-dasharray: 1, 0;" class="arrowMarkerPath" r="5" cy="5" cx="5"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="12" viewBox="0 0 11 11" class="marker cross flowchart" id="flowchart-crossEnd"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"/></marker><marker orient="auto" markerHeight="11" markerWidth="11" markerUnits="userSpaceOnUse" refY="5.2" refX="-1" viewBox="0 0 11 11" class="marker cross flowchart" id="flowchart-crossStart"><path style="stroke-width: 2; stroke-dasharray: 1, 0;" class="arrowMarkerPath" d="M 1,1 l 9,9 M 10,1 l -9,9"/></marker><g class="root"><g class="clusters"/><g class="edgePaths"><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-U LE-B" id="L-U-B-0" d="M613.4140625,34L613.4140625,38.166666666666664C613.4140625,42.333333333333336,613.4140625,50.666666666666664,613.4140625,59C613.4140625,67.33333333333333,613.4140625,75.66666666666667,613.4140625,79.83333333333333L613.4140625,84"/><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-B LE-FE" id="L-B-FE-0" d="M613.4140625,118L613.4140625,122.16666666666667C613.4140625,126.33333333333333,613.4140625,134.66666666666666,613.4140625,143C613.4140625,151.33333333333334,613.4140625,159.66666666666666,613.4140625,163.83333333333334L613.4140625,168"/><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-FE LE-StageAPI" id="L-FE-StageAPI-0" d="M570.609375,196.69595933926303L552.125,201.7466327827192C533.640625,206.79730622617535,496.671875,216.89865311308768,478.1875,226.1159932232105C459.703125,235.33333333333334,459.703125,243.66666666666666,459.703125,247.83333333333334L459.703125,252"/><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-FE LE-EnqueueAPI" id="L-FE-EnqueueAPI-0" d="M613.4140625,202L613.4140625,206.16666666666666C613.4140625,210.33333333333334,613.4140625,218.66666666666666,613.4140625,227C613.4140625,235.33333333333334,613.4140625,243.66666666666666,613.4140625,247.83333333333334L613.4140625,252"/><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-EnqueueAPI LE-E11" id="L-EnqueueAPI-E11-0" d="M613.4140625,286L613.4140625,290.1666666666667C613.4140625,294.3333333333333,613.4140625,302.6666666666667,613.4140625,311C613.4140625,319.3333333333333,613.4140625,327.6666666666667,613.4140625,331.8333333333333L613.4140625,336"/><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-E11 LE-E12" id="L-E11-E12-0" d="M613.4140625,370L613.4140625,374.1666666666667C613.4140625,378.3333333333333,613.4140625,386.6666666666667,613.4140625,395C613.4140625,403.3333333333333,613.4140625,411.6666666666667,613.4140625,415.8333333333333L613.4140625,420"/><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-E12 LE-E12a" id="L-E12-E12a-0" d="M613.4140625,454L613.4140625,458.1666666666667C613.4140625,462.3333333333333,613.4140625,470.6666666666667,613.4140625,479C613.4140625,487.3333333333333,613.4140625,495.6666666666667,613.4140625,499.8333333333333L613.4140625,504"/><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-E12a LE-E13" id="L-E12a-E13-0" d="M613.4140625,538L613.4140625,542.1666666666666C613.4140625,546.3333333333334,613.4140625,554.6666666666666,613.4140625,563C613.4140625,571.3333333333334,613.4140625,579.6666666666666,613.4140625,583.8333333333334L613.4140625,588"/><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-E13 LE-E14" id="L-E13-E14-0" d="M495.8307291666667,622L467.01128472222223,626.1666666666666C438.1918402777778,630.3333333333334,380.5529513888889,638.6666666666666,351.7335069444445,647C322.9140625,655.3333333333334,322.9140625,663.6666666666666,322.9140625,667.8333333333334L322.9140625,672"/><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-E13 LE-E15" id="L-E13-E15-0" d="M959.8270089285714,622L1044.732142857143,626.1666666666666C1129.6372767857144,630.3333333333334,1299.447544642857,638.6666666666666,1384.3526785714287,647C1469.2578125,655.3333333333334,1469.2578125,663.6666666666666,1469.2578125,667.8333333333334L1469.2578125,672"/><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-Scheduler LE-P16" id="L-Scheduler-P16-0" d="M2219.625,25.451371900826445L2188.1627604166665,31.04280991735537C2156.7005208333335,36.634247933884296,2093.7760416666665,47.81712396694215,2062.3138020833335,57.57522865013774C2030.8515625,67.33333333333333,2030.8515625,75.66666666666667,2030.8515625,79.83333333333333L2030.8515625,84"/><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-P16 LE-P17" id="L-P16-P17-0" d="M2030.8515625,118L2030.8515625,122.16666666666667C2030.8515625,126.33333333333333,2030.8515625,134.66666666666666,2030.8515625,143C2030.8515625,151.33333333333334,2030.8515625,159.66666666666666,2030.8515625,163.83333333333334L2030.8515625,168"/><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-P17 LE-P18" id="L-P17-P18-0" d="M2030.8515625,202L2030.8515625,206.16666666666666C2030.8515625,210.33333333333334,2030.8515625,218.66666666666666,2030.8515625,227C2030.8515625,235.33333333333334,2030.8515625,243.66666666666666,2030.8515625,247.83333333333334L2030.8515625,252"/><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-P18 LE-P19" id="L-P18-P19-0" d="M2030.8515625,286L2030.8515625,290.1666666666667C2030.8515625,294.3333333333333,2030.8515625,302.6666666666667,2030.8515625,311C2030.8515625,319.3333333333333,2030.8515625,327.6666666666667,2030.8515625,331.8333333333333L2030.8515625,336"/><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-Scheduler LE-D22" id="L-Scheduler-D22-0" d="M2314.734375,20.18092346741984L2411.4583333333335,26.650769556183203C2508.1822916666665,33.12061564494656,2701.6302083333335,46.06030782247328,2798.3541666666665,56.69682057790331C2895.078125,67.33333333333333,2895.078125,75.66666666666667,2895.078125,79.83333333333333L2895.078125,84"/><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-D22 LE-D23" id="L-D22-D23-0" d="M2895.078125,118L2895.078125,122.16666666666667C2895.078125,126.33333333333333,2895.078125,134.66666666666666,2895.078125,143C2895.078125,151.33333333333334,2895.078125,159.66666666666666,2895.078125,163.83333333333334L2895.078125,168"/><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-D23 LE-D24" id="L-D23-D24-0" d="M2895.078125,202L2895.078125,206.16666666666666C2895.078125,210.33333333333334,2895.078125,218.66666666666666,2895.078125,227C2895.078125,235.33333333333334,2895.078125,243.66666666666666,2895.078125,247.83333333333334L2895.078125,252"/><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-D24 LE-D25" id="L-D24-D25-0" d="M2895.078125,286L2895.078125,290.1666666666667C2895.078125,294.3333333333333,2895.078125,302.6666666666667,2895.078125,311C2895.078125,319.3333333333333,2895.078125,327.6666666666667,2895.078125,331.8333333333333L2895.078125,336"/><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-D25 LE-D26" id="L-D25-D26-0" d="M2895.078125,370L2895.078125,374.1666666666667C2895.078125,378.3333333333333,2895.078125,386.6666666666667,2895.078125,395C2895.078125,403.3333333333333,2895.078125,411.6666666666667,2895.078125,415.8333333333333L2895.078125,420"/><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-D26 LE-D27" id="L-D26-D27-0" d="M2895.078125,454L2895.078125,458.1666666666667C2895.078125,462.3333333333333,2895.078125,470.6666666666667,2895.078125,479C2895.078125,487.3333333333333,2895.078125,495.6666666666667,2895.078125,499.8333333333333L2895.078125,504"/><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-D27 LE-D28" id="L-D27-D28-0" d="M2895.078125,538L2895.078125,542.1666666666666C2895.078125,546.3333333333334,2895.078125,554.6666666666666,2895.078125,563C2895.078125,571.3333333333334,2895.078125,579.6666666666666,2895.078125,583.8333333333334L2895.078125,588"/><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-D28 LE-D29" id="L-D28-D29-0" d="M2595.4375,619.7046774016869L2502.7369791666665,624.2538978347392C2410.0364583333335,628.8031182677913,2224.6354166666665,637.9015591338956,2131.9348958333335,646.6174462336145C2039.234375,655.3333333333334,2039.234375,663.6666666666666,2039.234375,667.8333333333334L2039.234375,672"/><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-D28 LE-D30" id="L-D28-D30-0" d="M3021.5867745535716,622L3052.5937965029766,626.1666666666666C3083.600818452381,630.3333333333334,3145.614862351191,638.6666666666666,3176.6218843005954,647C3207.62890625,655.3333333333334,3207.62890625,663.6666666666666,3207.62890625,667.8333333333334L3207.62890625,672"/><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-D29 LE-D31" id="L-D29-D31-0" d="M2039.234375,706L2039.234375,710.1666666666666C2039.234375,714.3333333333334,2039.234375,722.6666666666666,2124.139508928571,731C2209.0446428571427,739.3333333333334,2378.854910714286,747.6666666666666,2463.760044642857,751.8333333333334L2548.6651785714284,756"/><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-D30 LE-D31" id="L-D30-D31-0" d="M3207.62890625,706L3207.62890625,710.1666666666666C3207.62890625,714.3333333333334,3207.62890625,722.6666666666666,3176.6218843005954,731C3145.614862351191,739.3333333333334,3083.600818452381,747.6666666666666,3052.5937965029766,751.8333333333334L3021.5867745535716,756"/><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-D31 LE-D32" id="L-D31-D32-0" d="M2753.294456845238,790L2718.5435577876983,794.1666666666666C2683.7926587301586,798.3333333333334,2614.2908606150795,806.6666666666666,2579.5399615575398,815C2544.7890625,823.3333333333334,2544.7890625,831.6666666666666,2544.7890625,835.8333333333334L2544.7890625,840"/><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-D31 LE-D33" id="L-D31-D33-0" d="M3036.861793154762,790L3071.6126922123017,794.1666666666666C3106.363591269841,798.3333333333334,3175.8653893849205,806.6666666666666,3210.6162884424607,815C3245.3671875,823.3333333333334,3245.3671875,831.6666666666666,3245.3671875,835.8333333333334L3245.3671875,840"/><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-SessionPushService LE-S34" id="L-SessionPushService-S34-0" d="M4014.4609375,24.886888472802344L3948.3763020833335,30.57240706066862C3882.2916666666665,36.25792564853489,3750.1223958333335,47.628962824267454,3684.0377604166665,57.481148078800395C3617.953125,67.33333333333333,3617.953125,75.66666666666667,3617.953125,79.83333333333333L3617.953125,84"/><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-SessionPushService LE-S35" id="L-SessionPushService-S35-0" d="M4197.8046875,21.37649190110827L4329.151041666667,27.647076584256894C4460.497395833333,33.917661267405514,4723.190104166667,46.45883063370275,4854.536458333333,56.89608198351805C4985.8828125,67.33333333333333,4985.8828125,75.66666666666667,4985.8828125,79.83333333333333L4985.8828125,84"/><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-RefDB LE-U40" id="L-RefDB-U40-0" d="M6610.8359375,22.22328516181559L6532.4140625,28.352737634846324C6453.9921875,34.48219010787706,6297.1484375,46.74109505393853,6218.7265625,57.037214193635926C6140.3046875,67.33333333333333,6140.3046875,75.66666666666667,6140.3046875,79.83333333333333L6140.3046875,84"/><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-RefDB LE-U41" id="L-RefDB-U41-0" d="M6677.6640625,34L6677.6640625,38.166666666666664C6677.6640625,42.333333333333336,6677.6640625,50.666666666666664,6677.6640625,59C6677.6640625,67.33333333333333,6677.6640625,75.66666666666667,6677.6640625,79.83333333333333L6677.6640625,84"/><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-RefDB LE-U42" id="L-RefDB-U42-0" d="M6744.4921875,21.89279294002288L6828.963541666667,28.077327450019066C6913.434895833333,34.26186196001525,7082.377604166667,46.630930980007626,7166.848958333333,56.98213215667048C7251.3203125,67.33333333333333,7251.3203125,75.66666666666667,7251.3203125,79.83333333333333L7251.3203125,84"/><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-FE LE-M43" id="L-FE-M43-0" d="M656.21875,187.86654957210658L753.6119791666666,194.3887913100888C851.0052083333334,200.91103304807106,1045.7916666666667,213.95551652403552,1143.1848958333333,224.64442492868443C1240.578125,235.33333333333334,1240.578125,243.66666666666666,1240.578125,247.83333333333334L1240.578125,252"/><path marker-end="url(#flowchart-pointEnd)" style="fill:none;" class="edge-thickness-normal edge-pattern-solid flowchart-link LS-M43 LE-M44" id="L-M43-M44-0" d="M1240.578125,286L1240.578125,290.1666666666667C1240.578125,294.3333333333333,1240.578125,302.6666666666667,1240.578125,311C1240.578125,319.3333333333333,1240.578125,327.6666666666667,1240.578125,331.8333333333333L1240.578125,336"/></g><g class="edgeLabels"><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g><g class="edgeLabel"><g transform="translate(0, 0)" class="label"><foreignObject height="0" width="0"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="edgeLabel"></span></div></foreignObject></g></g></g><g class="nodes"><g transform="translate(613.4140625, 17)" id="flowchart-U-158" class="node default default flowchart-label"><rect height="34" width="51.46875" y="-17" x="-25.734375" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-18.234375, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="36.46875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">User</span></div></foreignObject></g></g><g transform="translate(613.4140625, 101)" id="flowchart-B-159" class="node default default flowchart-label"><rect height="34" width="79.84375" y="-17" x="-39.921875" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-32.421875, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="64.84375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Browser</span></div></foreignObject></g></g><g transform="translate(613.4140625, 185)" id="flowchart-FE-160" class="node default default flowchart-label"><rect height="34" width="85.609375" y="-17" x="-42.8046875" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-35.3046875, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="70.609375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Frontend</span></div></foreignObject></g></g><g transform="translate(459.703125, 269)" id="flowchart-StageAPI-161" class="node default default flowchart-label"><rect height="34" width="91.640625" y="-17" x="-45.8203125" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-38.3203125, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="76.640625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Stage API</span></div></foreignObject></g></g><g transform="translate(613.4140625, 269)" id="flowchart-EnqueueAPI-162" class="node default default flowchart-label"><rect height="34" width="115.78125" y="-17" x="-57.890625" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-50.390625, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="100.78125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Enqueue API</span></div></foreignObject></g></g><g transform="translate(1329.26953125, 17)" id="flowchart-SenderService-163" class="node default default flowchart-label"><rect height="34" width="135.9375" y="-17" x="-67.96875" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-60.46875, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="120.9375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Sender Service</span></div></foreignObject></g></g><g transform="translate(1521.98828125, 17)" id="flowchart-DispatchService-164" class="node default default flowchart-label"><rect height="34" width="149.5" y="-17" x="-74.75" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-67.25, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="134.5"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Dispatch Service</span></div></foreignObject></g></g><g transform="translate(4106.1328125, 17)" id="flowchart-SessionPushService-165" class="node default default flowchart-label"><rect height="34" width="183.34375" y="-17" x="-91.671875" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-84.171875, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="168.34375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Session Push Service</span></div></foreignObject></g></g><g transform="translate(2267.1796875, 17)" id="flowchart-Scheduler-166" class="node default default flowchart-label"><rect height="34" width="95.109375" y="-17" x="-47.5546875" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-40.0546875, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="80.109375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Scheduler</span></div></foreignObject></g></g><g transform="translate(6677.6640625, 17)" id="flowchart-RefDB-167" class="node default db flowchart-label"><rect height="34" width="133.65625" y="-17" x="-66.828125" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-59.328125, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="118.65625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">Ref DB staging</span></div></foreignObject></g></g><g transform="translate(6879.421875, 17)" id="flowchart-DTPDB-168" class="node default db flowchart-label"><rect height="34" width="169.859375" y="-17" x="-84.9296875" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-77.4296875, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="154.859375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">DTP DB destination</span></div></foreignObject></g></g><g transform="translate(7069.234375, 17)" id="flowchart-ExternalDB-169" class="node default default flowchart-label"><rect height="34" width="109.765625" y="-17" x="-54.8828125" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-47.3828125, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="94.765625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">External DB</span></div></foreignObject></g></g><g transform="translate(613.4140625, 353)" id="flowchart-E11-178" class="node default default flowchart-label"><rect height="34" width="433.953125" y="-17" x="-216.9765625" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-209.4765625, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="418.953125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">11. SenderController.enqueue(payloadIds, senderId)</span></div></foreignObject></g></g><g transform="translate(613.4140625, 437)" id="flowchart-E12-180" class="node default default flowchart-label"><rect height="34" width="763.828125" y="-17" x="-381.9140625" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-374.4140625, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="748.828125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">12. SenderService.enqueuePayloadsWithResult(senderId, payloadIds, source) - dedupe check</span></div></foreignObject></g></g><g transform="translate(613.4140625, 521)" id="flowchart-E12a-182" class="node default default flowchart-label"><rect height="34" width="647.84375" y="-17" x="-323.921875" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-316.421875, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="632.84375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">12a. repository.findExisting(senderId, payloadIds) - checks existing payload ids</span></div></foreignObject></g></g><g transform="translate(613.4140625, 605)" id="flowchart-E13-184" class="node default default flowchart-label"><rect height="34" width="779.984375" y="-17" x="-389.9921875" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-382.4921875, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="764.984375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">13. For each new payload: repository.save(entry) -&gt; INSERT sender_queue_entry (status=NEW)</span></div></foreignObject></g></g><g transform="translate(322.9140625, 689)" id="flowchart-E14-186" class="node default default flowchart-label"><rect height="34" width="645.828125" y="-17" x="-322.9140625" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-315.4140625, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="630.828125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">14. On DataIntegrityViolationException (concurrent insert) -&gt; treat as SKIPPED</span></div></foreignObject></g></g><g transform="translate(1469.2578125, 689)" id="flowchart-E15-188" class="node default default flowchart-label"><rect height="34" width="416.171875" y="-17" x="-208.0859375" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-200.5859375, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="401.171875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">15. Return enqueuedCount + skipped list to caller</span></div></foreignObject></g></g><g transform="translate(2030.8515625, 101)" id="flowchart-P16-190" class="node default default flowchart-label"><rect height="34" width="444.140625" y="-17" x="-222.0703125" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-214.5703125, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="429.140625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">16. Scheduler triggers SenderService.scheduledRun()</span></div></foreignObject></g></g><g transform="translate(2030.8515625, 185)" id="flowchart-P17-192" class="node default default flowchart-label"><rect height="34" width="472.3125" y="-17" x="-236.15625" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-228.65625, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="457.3125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">17. runIfBelowThreshold: guard by countByStatus('NEW')</span></div></foreignObject></g></g><g transform="translate(2030.8515625, 269)" id="flowchart-P18-194" class="node default default flowchart-label"><rect height="34" width="715.9375" y="-17" x="-357.96875" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-350.46875, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="700.9375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">18. processBatch(limit): repository.findByStatusOrderByCreatedAt('NEW', PageRequest)</span></div></foreignObject></g></g><g transform="translate(2030.8515625, 353)" id="flowchart-P19-196" class="node default default flowchart-label"><rect height="34" width="760.171875" y="-17" x="-380.0859375" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-372.5859375, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="745.171875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">19. For each entry: set PROCESSING -&gt; send -&gt; on success set SENT -&gt; on failure set FAILED</span></div></foreignObject></g></g><g transform="translate(2895.078125, 101)" id="flowchart-D22-198" class="node default default flowchart-label"><rect height="34" width="469.984375" y="-17" x="-234.9921875" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-227.4921875, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="454.984375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">22. Scheduler triggers SenderDispatchService.dispatch()</span></div></foreignObject></g></g><g transform="translate(2895.078125, 185)" id="flowchart-D23-200" class="node default default flowchart-label"><rect height="34" width="703.625" y="-17" x="-351.8125" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-344.3125, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="688.625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">23. findSitesWithPending() - SELECT DISTINCT site FROM staging WHERE status=NEW</span></div></foreignObject></g></g><g transform="translate(2895.078125, 269)" id="flowchart-D24-202" class="node default default flowchart-label"><rect height="34" width="912.515625" y="-17" x="-456.2578125" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-448.7578125, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="897.515625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">24. fetchNextBatchForSite(site, limit) - SELECT ... WHERE status=NEW AND site=? ORDER BY created_at LIMIT ?</span></div></foreignObject></g></g><g transform="translate(2895.078125, 353)" id="flowchart-D25-204" class="node default default flowchart-label"><rect height="34" width="529.5625" y="-17" x="-264.78125" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-257.28125, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="514.5625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">25. Group by senderId -&gt; pushGroup(site, senderId, recordsList)</span></div></foreignObject></g></g><g transform="translate(2895.078125, 437)" id="flowchart-D26-206" class="node default default flowchart-label"><rect height="34" width="1087.015625" y="-17" x="-543.5078125" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-536.0078125, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="1072.015625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">26. Check maxQueueSize and safeCountQueue(id_sender) - SELECT COUNT(1) FROM DTP_SENDER_QUEUE_ITEM WHERE id_sender=?</span></div></foreignObject></g></g><g transform="translate(2895.078125, 521)" id="flowchart-D27-208" class="node default default flowchart-label"><rect height="34" width="495.90625" y="-17" x="-247.953125" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-240.453125, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="480.90625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">27. Compute available slots and cap toDispatch accordingly</span></div></foreignObject></g></g><g transform="translate(2895.078125, 605)" id="flowchart-D28-210" class="node default default flowchart-label"><rect height="34" width="599.28125" y="-17" x="-299.640625" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-292.140625, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="584.28125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">28. externalDbConfig.getConnection(site) -&gt; detect dialect via metadata</span></div></foreignObject></g></g><g transform="translate(2039.234375, 689)" id="flowchart-D29-212" class="node default default flowchart-label"><rect height="34" width="623.78125" y="-17" x="-311.890625" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-304.390625, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="608.78125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">29. If Oracle: SELECT SEQ.NEXTVAL; INSERT with explicit id (sequence path)</span></div></foreignObject></g></g><g transform="translate(3207.62890625, 689)" id="flowchart-D30-214" class="node default default flowchart-label"><rect height="34" width="526.421875" y="-17" x="-263.2109375" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-255.7109375, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="511.421875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">30. Else (identity): INSERT letting DB generate id (identity path)</span></div></foreignObject></g></g><g transform="translate(2895.078125, 773)" id="flowchart-D31-216" class="node default default flowchart-label"><rect height="34" width="941.46875" y="-17" x="-470.734375" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-463.234375, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="926.46875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">31. Handle SQLException: if duplicate (SQLState class 23) -&gt; treat as success (concurrent insert); else mark FAILED</span></div></foreignObject></g></g><g transform="translate(2544.7890625, 857)" id="flowchart-D32-220" class="node default default flowchart-label"><rect height="34" width="623.125" y="-17" x="-311.5625" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-304.0625, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="608.125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">32. markEnqueued(successIds) -&gt; UPDATE staging rows status=ENQUEUED</span></div></foreignObject></g></g><g transform="translate(3245.3671875, 857)" id="flowchart-D33-222" class="node default default flowchart-label"><rect height="34" width="678.03125" y="-17" x="-339.015625" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-331.515625, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="663.03125"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">33. On connection failure -&gt; markFailed(eachRecord, message) and schedule retry</span></div></foreignObject></g></g><g transform="translate(3617.953125, 101)" id="flowchart-S34-224" class="node default default flowchart-label"><rect height="34" width="875.765625" y="-17" x="-437.8828125" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-430.3828125, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="860.765625"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">34. claimNextBatch(sessionId,batchSize): transactional claim via SELECT..UPDATE to avoid duplicate claims</span></div></foreignObject></g></g><g transform="translate(4985.8828125, 101)" id="flowchart-S35-226" class="node default default flowchart-label"><rect height="34" width="1760.09375" y="-17" x="-880.046875" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-872.546875, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="1745.09375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">35. pushSessionBatch: gate writes by EXTERNAL_DB_ALLOW_WRITES; use sequence or generated keys; on integrity violation mark SKIPPED; on transient errors mark FAILED and schedule retry with exponential backoff</span></div></foreignObject></g></g><g transform="translate(6140.3046875, 101)" id="flowchart-U40-228" class="node default default flowchart-label"><rect height="34" width="448.75" y="-17" x="-224.375" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-216.875, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="433.75"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">40. updateStatus(ids,status,message) - batch UPDATE</span></div></foreignObject></g></g><g transform="translate(6677.6640625, 101)" id="flowchart-U41-230" class="node default default flowchart-label"><rect height="34" width="525.96875" y="-17" x="-262.984375" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-255.484375, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="510.96875"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">41. markEnqueued(ids) -&gt; updateStatus(ids,'ENQUEUED',NULL)</span></div></foreignObject></g></g><g transform="translate(7251.3203125, 101)" id="flowchart-U42-232" class="node default default flowchart-label"><rect height="34" width="521.34375" y="-17" x="-260.671875" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-253.171875, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="506.34375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">42. markFailed(id,msg) -&gt; updateStatus([id],'FAILED',message)</span></div></foreignObject></g></g><g transform="translate(1240.578125, 269)" id="flowchart-M43-234" class="node default default flowchart-label"><rect height="34" width="573.984375" y="-17" x="-286.9921875" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-279.4921875, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="558.984375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">43. Monitoring: StageController.list(...) -&gt; refDbService.listRecords(...)</span></div></foreignObject></g></g><g transform="translate(1240.578125, 353)" id="flowchart-M44-236" class="node default default flowchart-label"><rect height="34" width="720.375" y="-17" x="-360.1875" ry="0" rx="0" style="" class="basic label-container"/><g transform="translate(-352.6875, -9.5)" style="" class="label"><rect/><foreignObject height="19" width="705.375"><div style="display: inline-block; white-space: nowrap;" xmlns="http://www.w3.org/1999/xhtml"><span class="nodeLabel">44. Retry: retryFailed -&gt; set status=NEW for eligible nextAttemptAt&lt;=now and requeue</span></div></foreignObject></g></g></g></g></g></svg>