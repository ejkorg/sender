flowchart LR
  %% Level 1 DFD: Enqueue -> Queue -> Processing
  User["User / Frontend"]
  API["SenderController (handles POST /enqueue)"]
  DB[("App DB - sender_queue table")]
  Scheduler["DiscoveryScheduler"]
  Processor["SenderService.processQueueEntry()"]
  ExternalDBs[("External Data Sources")]
  Mail["MailService / SMTP"]

  User -->|"enqueue form"| API
  API -->|"validate & persist EnqueueRequest"| DB
  DB -->|"new SenderQueueEntry row"| Scheduler
  Scheduler -->|"fetch batch"| Processor
  Processor -->|"lookup metadata from external DBs"| ExternalDBs
  Processor -->|"update status in DB"| DB
  Processor -->|"send notifications"| Mail

  classDef datastore fill:#f0f9ff,stroke:#0284c7
  class DB,ExternalDBs datastore

  subgraph Notes
    N1["Queue rows are SenderQueueEntry entity"]
    N2["Metadata rows stored via ExternalMetadataRepository/JdbcExternalMetadataRepository"]
  end
